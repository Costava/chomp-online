<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Chomp Online</title><style>html{box-sizing:border-box}*,:after,:before{box-sizing:inherit}body,html{width:100%;height:100%;margin:0;border:0;padding:0}body{overflow:hidden;background-color:#000;font-family:sans-serif}a{color:inherit;text-decoration:underline;transition-property:color;transition-timing-function:ease;transition-duration:.2s}a:hover{color:#fff}.app-canvas,.app-container{position:absolute;margin:0;border:0;padding:0}.app-canvas{width:100%;height:100%;background-color:#79d}.modal{position:fixed;top:0;transform:translate(-50%,-100%);z-index:2000;transition-property:all;transition-timing-function:cubic-bezier(0,1,1,0);text-align:center;font-size:24px;background-color:#5d6}.menu,.modal{left:50%;padding:20px}.menu{position:absolute;transform:translate(-50%);visibility:hidden;display:flex;flex-direction:column;align-items:center}.menu>*,h1{margin-bottom:20px}h1{margin-top:0;text-align:center}.input-label{margin-bottom:0}button{background-color:#9bf;border-radius:4px;border:1px solid #357;box-shadow:0 10px 14px -7px #3e7327;padding:6px 12px;color:#000;font-weight:700;text-decoration:none;cursor:pointer;transition-property:background-color;transition-timing-function:ease;transition-duration:.2s}button:hover{background-color:#79d}button:active{position:relative;top:1px}</style></head><body><div class="app-container js-app-container"><canvas class="app-canvas js-app-canvas">Your browser does not support canvas elements.</canvas><div class="menu main-menu js-main-menu"><h1>Chomp Online</h1><button class="js-main-join">Join Game</button> <button class="js-main-host">Host Game</button> <button class="js-main-about">About</button> <button class="js-main-exit">Exit</button></div><div class="menu join-menu js-join-menu"><h1>Join Game</h1><label class="input-label">Host/IP</label><input type="text" value="127.0.0.1" class="js-join-host-input"><label class="input-label">Port</label><input type="number" value="7000" min="1" class="js-join-port-input"><button class="js-join-join">Join</button> <button class="js-join-back">Back</button></div><div class="menu joining-menu js-joining-menu"><div>Connecting...</div><button class="js-joining-cancel">Cancel</button></div><div class="menu lobby-menu js-lobby-menu"><div>Waiting for host to start game<span>...</span></div><button class="js-lobby-leave">Leave</button></div><div class="menu setup-menu js-setup-menu"><label class="input-label">Board width</label><input type="number" min="2" step="1" value="16" class="js-board-width"><label class="input-label">Board height</label><input type="number" min="2" step="1" value="9" class="js-board-height"><button class="js-setup-start">Start</button> <button class="js-setup-leave">Leave</button></div><div class="menu hosting-menu js-hosting-menu"><div>Waiting for a player...</div><button class="js-hosting-cancel">Cancel</button></div><div class="menu host-menu js-host-menu"><h1>Host Game</h1><label class="input-label">Port</label><input type="number" value="7000" min="1" class="js-host-port-input"><button class="js-host-host">Host</button> <button class="js-host-back">Back</button></div><div class="menu about-menu js-about-menu"><h1>Chomp Online</h1><div>Author: <a class="js-author-link" href="">Costava</a></div><div>Version: 1.1.0</div><div><a class="js-source-link" href="">View source on GitHub</a></div><button class="js-about-back">Back</button></div><div class="menu no-connection-menu js-no-connection-menu"><h1>No Connection</h1><div class="js-no-connection-message"></div><button class="js-no-connection-back">Return to Main Menu</button></div><script>!function(t){function e(n){if(o[n])return o[n].exports;var i=o[n]={exports:{},id:n,loaded:!1};return t[n].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var o={};return e.m=t,e.c=o,e.p="",e(0)}([function(t,e,o){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function i(t){return"number"==typeof t&&Math.floor(t)==t&&t>=2}function s(){return document.querySelector(".js-join-host-input").value}function r(){var t=document.querySelector(".js-join-port-input").value;return Number(t)}function l(){var t=document.querySelector(".js-join-host-input").value,e=document.querySelector(".js-join-port-input").value,o=Number(e),n=document.querySelector(".js-join-join");(0,x.default)(t)&&(0,k.default)(o)?n.disabled=!1:n.disabled=!0}function c(){var t=document.querySelector(".js-host-port-input").value;return Number(t)}function a(){var t=document.querySelector(".js-host-port-input").value,e=Number(t),o=document.querySelector(".js-host-host");(0,k.default)(e)?o.disabled=!1:o.disabled=!0}function u(){var t=document.body,e=document.querySelector(".js-app-container"),o=document.querySelector(".js-app-canvas"),n=(0,y.default)(_,H,t.offsetWidth,t.offsetHeight);e.style.width=n.width+"px",e.style.height=n.height+"px",o.width=n.width,o.height=n.height;var i=t.offsetWidth-n.width,s=t.offsetHeight-n.height;e.style.marginLeft=Math.floor(i/2)+"px",e.style.marginRight=Math.ceil(i/2)+"px",e.style.marginTop=Math.floor(s/2)+"px",e.style.marginBottom=Math.ceil(s/2)+"px",E.render()}var h=o(8),d=n(h),f=o(1),p=n(f),m=o(2),y=n(m),g=o(3),b=(n(g),o(6)),v=n(b),j=o(5),w=n(j),S=o(10),k=n(S),C=o(9),x=n(C);console.log("Welcome");var W=o(4).remote,q=W.getCurrentWindow(),M=o(4),T=M.shell,P=document.querySelector(".js-app-canvas"),_=(P.getContext("2d"),16),H=9,E=new w.default(P);E.showLobbyMenu=function(t){t?Z.start("lobby"):Z.stop("lobby")},E.winCallback=function(){E.isHost()?Z.start("setup"):Z.start("lobby")},E.loseCallback=E.winCallback,E.joiningCallbacks.error=function(t){alert("Returning to main menu. Error joining: "+t),console.log("Returning to main menu. Error joining:"),console.log(t),Z.stop("joining"),Z.start("main")},E.joiningCallbacks.connected=function(){console.log("Connected to peer successfully"),Z.stop("joining"),E.server.callbacks=E.gameCallbacks,Z.start("lobby")},E.hostingCallbacks.error=function(t){alert("Returning to main menu. Error: "+t),console.log("Returning to main menu. Error:"),console.log(t),Z.stop("hosting"),Z.start("main")},E.hostingCallbacks.connected=function(){console.log("Connected to peer successfully"),Z.stop("hosting"),E.server.callbacks=E.gameCallbacks,Z.start("setup")},E.gameCallbacks.end=function(){Z.stopAllCurrent(),Z.start("main")},E.gameCallbacks.error=function(){Z.stopAllCurrent(),Z.start("main")},E.gameCallbacks.data=function(t){E.handleData(t)};var Z=new v.default;Z.add({element:document.querySelector(".js-main-menu"),name:"main",showZ:1e3,hideZ:-1e3,startWork:function(){},stopWork:function(){},listenerSystems:[new p.default(document.querySelector(".js-main-join"),"click",function(){Z.stop("main"),Z.start("join")}),new p.default(document.querySelector(".js-main-host"),"click",function(){Z.stop("main"),Z.start("host")}),new p.default(document.querySelector(".js-main-about"),"click",function(){Z.stop("main"),Z.start("about")}),new p.default(document.querySelector(".js-main-exit"),"click",function(){q.close()})]}),Z.add({element:document.querySelector(".js-join-menu"),name:"join",showZ:1e3,hideZ:-1e3,startWork:function(){l()},stopWork:function(){},listenerSystems:[new p.default(document.querySelector(".js-join-join"),"click",function(){console.log("Pressed join"),Z.stop("join");var t=s(),e=r();E.tryJoin(t,e),Z.start("joining")}),new p.default(document.querySelector(".js-join-back"),"click",function(){Z.stop("join"),Z.start("main")}),new p.default(document.querySelector(".js-join-host-input"),"change",l),new p.default(document.querySelector(".js-join-port-input"),"change",l)]}),Z.add({element:document.querySelector(".js-joining-menu"),name:"joining",showZ:1e3,hideZ:-1e3,startWork:function(){},stopWork:function(){},listenerSystems:[new p.default(document.querySelector(".js-joining-cancel"),"click",function(){E.server.destroy(),Z.stop("joining"),Z.start("main")})]}),Z.add({element:document.querySelector(".js-lobby-menu"),name:"lobby",showZ:1e3,hideZ:-1e3,startWork:function(){},stopWork:function(){},listenerSystems:[new p.default(document.querySelector(".js-lobby-leave"),"click",function(){E.server.destroy(),Z.stop("lobby"),Z.start("main")})]}),Z.add({element:document.querySelector(".js-setup-menu"),name:"setup",showZ:1e3,hideZ:-1e3,startWork:function(){},stopWork:function(){},listenerSystems:[new p.default(document.querySelector(".js-setup-start"),"click",function(){Z.stop("setup");var t=Math.ceil(Number(document.querySelector(".js-board-width").value)),e=Math.ceil(Number(document.querySelector(".js-board-height").value));t=i(t)?t:4,e=i(e)?e:4,E.boardWidth=t,E.boardHeight=e,E.sendCommand("BOARD_WIDTH "+t),E.sendCommand("BOARD_HEIGHT "+e),E.sendCommand("YOUR_TURN "+String(!E.myTurn)),E.sendCommand("GAME_START"),E.started=!0,E.board=w.default.getEmptyBoard(E.boardWidth,E.boardHeight),E.drawBoard(),setTimeout(function(){E.start()},0)}),new p.default(document.querySelector(".js-setup-leave"),"click",function(){E.server.destroy(),Z.stop("setup"),Z.start("main")})]}),Z.add({element:document.querySelector(".js-hosting-menu"),name:"hosting",showZ:1e3,hideZ:-1e3,startWork:function(){},stopWork:function(){},listenerSystems:[new p.default(document.querySelector(".js-hosting-cancel"),"click",function(){console.log("Pressed cancel on hosting menu"),Z.stop("hosting"),E.server.destroy(),Z.start("main")})]}),Z.add({element:document.querySelector(".js-host-menu"),name:"host",showZ:1e3,hideZ:-1e3,startWork:function(){a()},stopWork:function(){},listenerSystems:[new p.default(document.querySelector(".js-host-host"),"click",function(){console.log("Pressed host"),Z.stop("host");var t=c();E.waitForPlayer(t),Z.start("hosting")}),new p.default(document.querySelector(".js-host-back"),"click",function(){Z.stop("host"),E.server.destroy(),Z.start("main")}),new p.default(document.querySelector(".js-host-port-input"),"change",a)]}),Z.add({element:document.querySelector(".js-about-menu"),name:"about",showZ:1e3,hideZ:-1e3,startWork:function(){},stopWork:function(){},listenerSystems:[new p.default(document.querySelector(".js-author-link"),"click",function(t){t.preventDefault(),T.openExternal("https://github.com/Costava")}),new p.default(document.querySelector(".js-source-link"),"click",function(t){t.preventDefault(),T.openExternal("https://github.com/Costava/chomp-online")}),new p.default(document.querySelector(".js-about-back"),"click",function(){Z.stop("about"),Z.start("main")})]}),Z.start("main");var A=new d.default(u,150),B=new p.default(window,"resize",A.set.bind(A));B.start(),u()},function(t,e){"use strict";function o(t,e,o){this.target=t,this.eventType=e,this.work=o,this.active=!1}Object.defineProperty(e,"__esModule",{value:!0}),o.prototype.start=function(){this.active||(this.target.addEventListener(this.eventType,this.work),this.active=!0)},o.prototype.stop=function(){this.active&&(this.target.removeEventListener(this.eventType,this.work),this.active=!1)},e.default=o},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,o,n){if(o<=0||n<=0)return{width:0,height:0};if(t<0||e<0||0===t&&0===e)return{width:0,height:0};if(0===t)return{width:0,height:n};if(0===e)return{width:o,height:0};var i,s,r=t/e,l=o/n;if(r===l)i=o,s=n;else if(r<l){var c=Math.floor(n/e);i=c*t,s=c*e}else if(r>l){var c=Math.floor(o/t);i=c*t,s=c*e}else console.log("Unknown MaxChildSize condition. "+("childAspectWidth: "+t+", ")+("childAspectHeight: "+e+", ")+("parentWidth: "+o+", ")+("parentHeight: "+n));return{width:i,height:s}}},function(t,e){"use strict";function o(t){this.element=t.element,this.name=t.name||"menu"+Date.now(),this.showZ=t.showZ||1e3,this.hideZ=t.hideZ||-1e3,this.startWork=t.startWork||function(){console.log("startWork for menu: "+this.name)},this.stopWork=t.stopWork||function(){console.log("stopWork for menu: "+this.name)},this.listenerSystems=t.listenerSystems||[],this.hide(),this.stopListenerSystems(),this.on=!1}Object.defineProperty(e,"__esModule",{value:!0}),o.prototype.show=function(){this.element.style["z-index"]=this.showZ,this.element.style.visibility="visible",this.shown=!0},o.prototype.hide=function(){this.element.style["z-index"]=this.hideZ,this.element.style.visibility="hidden",this.shown=!1},o.prototype.startListenerSystems=function(){this.listenerSystems.forEach(function(t){t.start()}),this.listenerSystemsActive=!0},o.prototype.stopListenerSystems=function(){this.listenerSystems.forEach(function(t){t.stop()}),this.listenerSystemsActive=!1},o.prototype.start=function(){this.on||(this.show(),this.startListenerSystems(),this.on=!0,this.startWork())},o.prototype.stop=function(){this.on&&(this.stopListenerSystems(),this.hide(),this.stopWork(),this.on=!1)},e.default=o},function(t,e){t.exports=require("electron")},function(t,e,o){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function i(t){this.can=t,this.ctx=t.getContext("2d"),this.server=new r.default,this.hostToJoin=null,this.portToJoin=null,this.hostingPort=null,this.started=!1,this.myTurn=!1,this.boardWidth=5,this.boardHeight=5,this.board=null,this.cellBorderProp=.08,this.cellInnerColor="#58ff33",this.cellPoisonColor="#ff4418",this.commands={BOARD_WIDTH:function(t){var e=t[1];this.started?console.log("Game already started. Ignoring board width: "+e):(this.boardWidth=e,console.log("Set board width to: "+e))}.bind(this),BOARD_HEIGHT:function(t){var e=t[1];this.started?console.log("Game already started. Ignoring board height: "+e):(this.boardHeight=e,console.log("Set board height to: "+e))}.bind(this),GAME_START:function(t){this.started?console.log("Game already started."):(console.log("Starting game"),this.started=!0,this.board=i.getEmptyBoard(this.boardWidth,this.boardHeight),this.showLobbyMenu(!1),this.render(),this.start())}.bind(this),YOUR_TURN:function(t){var e="true"===t[1];this.myTurn=e}.bind(this),PLACE:function(t){var e=Number(t[1]),o=Number(t[2]);this.place({x:e,y:o}),this.myTurn=!0,this.render(),0==e&&0==o?(console.log("You win!"),this.cleanUp(),i.sendModal("You win!"),this.winCallback()):this.notifyTurn()}.bind(this)},this.joiningCallbacks={connected:null,connecting:null,end:null,error:null,data:null},this.hostingCallbacks={connected:null,connecting:null,end:null,error:null,data:null},this.gameCallbacks={connected:null,connecting:null,end:null,error:null,data:null}}Object.defineProperty(e,"__esModule",{value:!0});var s=o(7),r=n(s),l=o(2),c=n(l),a=o(1),u=n(a);i.Eaten=1,i.Uneaten=0,i.sendModal=function(t){var e=3,o=document.createElement("div");o.setAttribute("class","modal"),o.setAttribute("id",String(Date.now())),o.innerHTML=t,o.style.transitionDuration=String(e)+"s",document.body.appendChild(o),setTimeout(function(t){return function(){t.style.top="100%",t.style.transform="translate(-50%, 0)"}}(o),50),setTimeout(function(t){return function(){t.parentNode.removeChild(t)}}(o),1e3*e)},i.prototype.notifyTurn=function(){i.sendModal("Your turn!")},i.prototype.isHost=function(){return null==this.hostToJoin},i.prototype.cleanUp=function(){console.log("stop mouseLS"),this.mouseLS.stop(),this.started=!1},i.prototype.start=function(){this.mouseLS=new u.default(window,"click",function(t){var e=this.getCellSize(),o=this.can.getBoundingClientRect(),n=t.pageX-o.left-(this.can.offsetWidth-e.x*this.boardWidth)/2,s=t.pageY-o.top-(this.can.offsetHeight-e.y*this.boardHeight)/2,r=Math.floor(n/e.x),l=Math.floor(s/e.y),c={x:r,y:l};this.myTurn&&this.validCoord(c)&&!this.isEaten(c)&&(this.place(c),this.myTurn=!1,this.render(),this.sendCommand("PLACE "+c.x+" "+c.y),0==c.x&&0==c.y&&(console.log("You lose!"),this.cleanUp(),i.sendModal("You lose!"),this.loseCallback()))}.bind(this)),console.log("start mouseLS"),this.mouseLS.start(),this.myTurn&&this.notifyTurn()},i.prototype.validCoord=function(t){return t.x>=0&&t.x<this.boardWidth&&t.y>=0&&t.y<this.boardHeight},i.prototype.isEaten=function(t){return this.board[t.y][t.x]==i.Eaten},i.prototype.place=function(t){for(var e=t.y;e<this.boardHeight;e+=1)for(var o=t.x;o<this.boardWidth;o+=1)this.board[e][o]=i.Eaten},i.getEmptyBoard=function(t,e){for(var o=[],n=0;n<e;n+=1){o.push([]);for(var s=0;s<t;s+=1)o[n].push(i.Uneaten)}return o},i.prototype.getBoardSize=function(){return(0,c.default)(this.boardWidth,this.boardHeight,this.can.width,this.can.height)},i.prototype.getCellSize=function(){var t=this.getBoardSize(),e=t.width/this.boardWidth,o=t.height/this.boardHeight;return{x:e,y:o}},i.prototype.render=function(){this.ctx.clearRect(0,0,this.can.width,this.can.height),this.drawBoard()},i.prototype.drawBoard=function(){if(this.started){var t=this.getBoardSize(),e=this.getCellSize();this.ctx.save(),this.ctx.translate((this.can.width-t.width)/2,(this.can.height-t.height)/2);for(var o=0;o<this.boardHeight;o+=1)for(var n=0;n<this.boardWidth;n+=1)this.board[o][n]===i.Uneaten?(this.ctx.save(),this.ctx.translate(n*e.x,o*e.y),this.ctx.translate(this.cellBorderProp*e.x,this.cellBorderProp*e.y),this.ctx.fillStyle=this.cellInnerColor,this.ctx.fillRect(0,0,(1-2*this.cellBorderProp)*e.x,(1-2*this.cellBorderProp)*e.y),this.ctx.restore()):this.board[o][n]!==i.Eaten&&console.log("Unknown value on board: "+this.board[o][n]+(" at row "+o+" and column "+n+". Board: ")+this.board);this.isEaten({x:0,y:0})||(this.ctx.save(),this.ctx.fillStyle=this.cellPoisonColor,this.ctx.fillRect(0,0,e.x,e.y),this.ctx.restore()),this.ctx.restore()}},i.prototype.tryJoin=function(t,e){this.hostToJoin=t,this.portToJoin=e,this.server.callbacks=this.joiningCallbacks,this.server.join(this.hostToJoin,this.portToJoin)},i.prototype.waitForPlayer=function(t){this.hostingPort=t,this.hostToJoin=null,this.portToJoin=null,this.server.callbacks=this.hostingCallbacks,this.server.host(this.hostingPort)},i.prototype.sendCommand=function(t){console.log("Sending command: "+t),this.server.send(">"+t)},i.prototype.handleData=function(t){var e=t.toString();console.log("Received: "+e);for(var o=e.split(">"),n=1;n<o.length;n+=1){var i=o[n],s=i.split(" "),r=s[0];console.log("Looking up "+r),"function"==typeof this.commands[r]?(console.log("Calling: "+i),this.commands[r](s)):console.log("Discarding: "+i)}},e.default=i},function(t,e,o){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function i(){this.menus={},this.currentMenus=[]}Object.defineProperty(e,"__esModule",{value:!0});var s=o(3),r=n(s);i.prototype.add=function(t){this.menus[t.name]=new r.default(t)},i.prototype.start=function(t){var e=this.menus[t];e.start(),this.currentMenus.includes(e)?console.log("Warning from MenuHub. "+e.name+" already a current menu"):this.currentMenus.push(e)},i.prototype.stop=function(t){var e=this.menus[t];e.stop(),this.currentMenus.splice(this.currentMenus.indexOf(e),1)},i.prototype.stopAll=function(){for(var t in this.menus)this.menus[t].stop()},i.prototype.stopAllCurrent=function(){this.currentMenus.forEach(function(t){t.stop()})},e.default=i},function(t,e,o){"use strict";function n(){this.s=null,this.client=null,this.hostPort=null,this.joinHost=null,this.joinPort=null,this.callbacks={connected:null,connecting:null,end:null,error:null,data:null}}Object.defineProperty(e,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=o(11);n.default={hostPort:8e3,joinPort:8e3},n.prototype.callback=function(t){var e=this.callbacks[t];if("function"==typeof e){var o=Array.prototype.slice.call(arguments,1);e.apply(null,o)}},n.prototype.destroy=function(){console.log("Will destroy server"),"object"===i(this.s)&&null!==this.s&&(console.log("Close server"),this.s.close(),this.s=null),"object"===i(this.client)&&null!==this.client&&(console.log("End client"),this.client.end(),this.client.destroy(),this.client=null)},n.prototype.connected=function(){return null!=this.client},n.prototype.send=function(t){this.connected()&&this.client.write(t)},n.prototype.host=function(t){this.hostPort=t||n.default.hostPort,this.s=s.createServer(function(t){this.client=t,this.prepClient(this.client),this.s.close(),this.s=null,this.callback("connected")}.bind(this)),this.s.on("error",function(t){this.s.close(),this.s=null,this.callback("error",t)}.bind(this)),this.s.listen(t,function(){console.log("Hosting on port "+this.hostPort),console.log("Waiting for player to connect..."),this.callback("connecting")}.bind(this))},n.prototype.join=function(t,e){this.joinHost=t,this.joinPort=e||n.default.joinPort,this.client=s.connect({host:this.joinHost,port:this.joinPort},function(){console.log("Connected to "+this.joinHost+":"+this.joinPort),this.callback("connected")}.bind(this)),this.prepClient(this.client),this.callback("connecting")},n.prototype.prepClient=function(t){t.on("error",function(t){console.log("Error with connection to client:"),console.log(t),this.client.destroy(),this.client=null,this.callback("error",t)}.bind(this)),t.on("end",function(){console.log("Connection to client ended\n"),this.client.destroy(),this.client=null,this.callback("end")}.bind(this)),t.on("data",function(t){this.callback("data",t)}.bind(this))},e.default=n},function(t,e){"use strict";function o(t,e){this.work=t,this.delay=e,this.waiting=!1,this.timeout}Object.defineProperty(e,"__esModule",{value:!0}),o.prototype.set=function(){this.waiting&&clearTimeout(this.timeout),this.timeout=setTimeout(function(){this.waiting=!1,this.work()}.bind(this),this.delay),this.waiting=!0},o.prototype.clear=function(){this.waiting&&(clearTimeout(this.timeout),this.waiting=!1)},e.default=o},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return"string"==typeof t&&t.length>0}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return"number"==typeof t&&t>0}},function(t,e){t.exports=require("net")}]);</script></div></body></html>